<html>
	<head>
		<title>AlephZero Playground</title>
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css" />
	</head>
	<body>
		<nav class="navbar is-dark">
			<div class="navbar-brand">
				<a class="navbar-item" href="https://github.com/alephzero">
					<img src="https://avatars1.githubusercontent.com/u/48891271" height="28" style="filter: invert(1)">
				</a>
			</div>
			<div class="navbar-menu">
				<div class="navbar-start">
					<a class="navbar-item">
						Config
					</a>
					<a class="navbar-item">
						Subscriber Mapping
					</a>
					<a class="navbar-item">
						RPC Server Mapping
					</a>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">
							Language
						</a>
						<div class="navbar-dropdown">
							<a class="navbar-item">
								C++
							</a>
							<a class="navbar-item">
								Python
							</a>
							<a class="navbar-item">
								Go
							</a>
						</div>
					</div>
					<div class="navbar-item has-dropdown is-hoverable">
						<a class="navbar-link">
							Example
						</a>
						<div class="navbar-dropdown">
							<a class="navbar-item">
								Pubsub
							</a>
							<a class="navbar-item">
								RPC
							</a>
							<a class="navbar-item">
								Unmanaged
							</a>
						</div>
					</div>
				</div>
				<div class="navbar-end">
					<div class="tag is-dark">Ctrl + ENTER to Run</div>
				</div>
			</div>
		</nav>

		<div class="columns is-gapless" style="height: 100%">
			<div class="column" style="margin: 1px">
				<pre id="code" style="height: 100%; font-size: 1.25em;"></pre>
			</div>
			<div class="column" style="margin: 1px; overflow: auto;">
				<pre id="output" class="has-background-dark" style="height: 100%; font-size: 1em;"></pre>
			</div>
		</div>

		<script id="ace" defer src="//cdnjs.cloudflare.com/ajax/libs/ace/1.4.5/ace.js"></script>
		<script>
			const ace_script = document.querySelector('#ace')
			ace_script.onload = () => {
				var editor = ace.edit('code')
				editor.setTheme('ace/theme/tomorrow_night_eighties')
				editor.session.setMode('ace/mode/python')
				editor.focus()

				editor.setValue(`print('Hello, World!')\n`, 1)

				const output_elem = document.querySelector('#output')

				document.addEventListener('keydown', e => {
					var ctrl = e.metaKey || e.ctrlKey
					var enter = e.keyCode === 13

					if (ctrl && enter) {
						e.preventDefault()
						output_elem.innerHTML = ''
						output_elem.innerHTML += '<div class="has-text-info">Running...</div>'

						fetch('/api/run', {
							method: 'POST',
							body: editor.getValue(),
						})
						.then(resp => resp.json())
						.then(data => {
							output_elem.innerHTML = `<div class="has-text-primary">${data.stdout}</div><div class="has-text-danger">${data.stderr}</div>`
						})
						.catch(err => {
							output_elem.innerHTML = `<div class="has-text-danger">${err.message}</div>`
						})
					}
				})
			}
		</script>
	</body>
</html>
